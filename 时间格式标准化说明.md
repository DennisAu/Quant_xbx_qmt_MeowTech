# 时间格式标准化说明

## 概述

本文档说明了实盘无限守护程序中时间格式的标准化工作，确保代码实现与文档描述的一致性。

## 统一标准

### 时间格式规范
- **标准格式**：`HH:MM:SS` (24小时制，秒级精度)
- **示例**：`"09:28:00"`, `"15:30:00"`, `"16:00:00"`
- **适用范围**：所有时间配置参数

### 格式选择理由
1. **代码一致性**：与程序内部实际使用的格式保持一致
2. **精度需求**：秒级精度满足定时任务的准确性要求
3. **可扩展性**：为未来可能的秒级定时需求预留空间
4. **标准化**：符合ISO 8601时间表示标准

## 涉及的时间参数

### 核心时间配置
| 参数名称 | 含义 | 默认值 | 说明 |
|---------|------|--------|------|
| `qmt_run_time` | QMT程序运行时间 | `"09:28:00"` | 开盘前2分钟启动 |
| `QMT_RESTART_TIME` | QMT定时重启时间 | `"08:50:00"` | 开盘前10分钟重启 |
| `RAINBOW_RESTART_TIME` | 彩虹客户端定时重启时间 | `"08:45:00"` | 比QMT早5分钟重启 |
| `QMT_SHUTDOWN_TIME` | QMT定时关闭时间 | `"15:30:00"` | 收盘后30分钟关闭 |
| `RAINBOW_SHUTDOWN_TIME` | 彩虹客户端定时关闭时间 | `"15:35:00"` | 比QMT晚5分钟关闭 |
| `SYSTEM_SHUTDOWN_TIME` | 系统定时关机时间 | `"16:00:00"` | 收盘后1小时关机 |

### 时间逻辑关系
```
08:45:00 → 彩虹客户端重启
08:50:00 → QMT重启
09:28:00 → QMT程序运行
09:30:00 → 股市开盘
15:00:00 → 股市收盘
15:30:00 → QMT关闭
15:35:00 → 彩虹客户端关闭
16:00:00 → 系统关机
```

## 配置示例

### 生产环境配置
```python
# ============ USER CONFIG ============
# 时间配置 - 生产环境
qmt_run_time = "09:28:00"              # QMT运行时间
QMT_RESTART_TIME = "08:50:00"          # QMT重启时间
RAINBOW_RESTART_TIME = "08:45:00"      # 彩虹客户端重启时间
QMT_SHUTDOWN_TIME = "15:30:00"         # QMT关闭时间
RAINBOW_SHUTDOWN_TIME = "15:35:00"     # 彩虹客户端关闭时间
SYSTEM_SHUTDOWN_TIME = "16:00:00"      # 系统关机时间
```

### 开发环境配置
```python
# ============ USER CONFIG ============
# 时间配置 - 开发环境
qmt_run_time = "09:28:00"              # QMT运行时间
QMT_RESTART_TIME = "09:00:00"          # 开发时间较晚
RAINBOW_RESTART_TIME = "08:55:00"      # 彩虹客户端重启时间
QMT_SHUTDOWN_TIME = "15:00:00"         # 提前关闭
RAINBOW_SHUTDOWN_TIME = "15:05:00"     # 彩虹客户端关闭时间
SYSTEM_SHUTDOWN_TIME = "15:30:00"      # 系统关机时间
```

## 验证方法

### 时间格式验证
```python
from datetime import datetime

def validate_time_format(time_str):
    """验证时间格式是否符合HH:MM:SS标准"""
    try:
        datetime.strptime(time_str, "%H:%M:%S")
        return True
    except ValueError:
        return False

# 使用示例
time_configs = [
    "09:28:00",  # ✓ 正确格式
    "08:50:00",  # ✓ 正确格式
    "15:30:00",  # ✓ 正确格式
    "09:28",     # ✗ 错误格式
    "8:50:00",   # ✗ 错误格式（小时应为两位数）
]

for time_config in time_configs:
    is_valid = validate_time_format(time_config)
    print(f"{time_config}: {'✓' if is_valid else '✗'}")
```

### GUI界面提示
程序GUI界面中的时间输入框已统一使用`HH:MM:SS`格式提示：
```python
self.qmt_shutdown_time_edit.setPlaceholderText("HH:MM:SS，留空则不执行")
self.rainbow_shutdown_time_edit.setPlaceholderText("HH:MM:SS，留空则不执行")
self.system_shutdown_time_edit.setPlaceholderText("HH:MM:SS，留空则不执行")
```

## 迁移指南

### 从HH:MM格式迁移
如果您之前使用的是`HH:MM`格式，请按以下方式更新：

**旧格式 → 新格式**
- `"08:50"` → `"08:50:00"`
- `"15:30"` → `"15:30:00"`
- `"16:00"` → `"16:00:00"`

### 批量更新脚本
```python
def migrate_time_format(old_time):
    """将HH:MM格式转换为HH:MM:SS格式"""
    if len(old_time) == 5 and old_time.count(':') == 1:
        return old_time + ":00"
    return old_time

# 使用示例
old_configs = ["08:50", "15:30", "16:00"]
new_configs = [migrate_time_format(t) for t in old_configs]
print(new_configs)  # ['08:50:00', '15:30:00', '16:00:00']
```

## 注意事项

### 兼容性考虑
1. **向后兼容**：程序内部会自动处理不同格式的时间输入
2. **错误处理**：无效时间格式会触发验证错误并给出提示
3. **默认行为**：空值或无效值将禁用对应的定时功能

### 最佳实践
1. **统一使用**：所有时间配置都使用`HH:MM:SS`格式
2. **文档同步**：确保代码注释和文档描述保持一致
3. **测试验证**：修改时间配置后进行充分测试
4. **备份配置**：修改前备份原有配置文件

## 相关文档

- [配置参数说明.md](./配置参数说明.md) - 详细的参数配置说明
- [最佳实践指南.md](./最佳实践指南.md) - 配置和使用的最佳实践
- [故障排除指南.md](./故障排除指南.md) - 常见问题的解决方案

---

**更新日期**：2025年06月
**版本**：v1.0
**状态**：已完成标准化